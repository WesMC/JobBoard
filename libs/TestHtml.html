<!DOCTYPE html>
<html lang="en" ng-app="myApp">
	<head>
		<meta http-equiv="X-UA-Compatible">
	        <meta name="viewport" content="width=device-width, initial-scale=1">
        	<meta charset="utf-8">
		<title>This is a test html page with NO css</title>
		<script src="angular-1.5.8.min.js"></script>
		<script src="jquery-3.1.1.min.js"></script>
		<script src="bootstrap_3.3.5.min.js"></script>
		<script src="bootcards_1.1.2.min.js"></script>
        <script src="x2js-master/xml2json.js"></script>
		<script src="ui-bootstrap-tpls-2.2.0.min.js"></script>
		<link rel="stylesheet" href="bootstrap_3.3.4.min.css">
	</head>
	<body>
		<div class="container" ng-controller="myCtrl">
			<h1>Tabs</h1>
			<ul class="nav nav-pills nav-justified">
				<li class="active"><a data-toggle="tab" href="#ProgrammingJobs">Programming Jobs</a></li>
				<li><a data-toggle="tab" href="#WritingJobs">Writing Jobs</a></li>
				<li><a data-toggle="tab" href="#AllJobs">All Jobs</a></li>
			</ul>
        </div>
        <div class="container" ng-controller="parseString">
            <div class="tab-content">
				<div class="tab-pane fade in active" id="ProgrammingJobs">
					<h3>Programming Jobs</h3>
					<p>Here are some programming jobs</p>
					<div class="bootcards-list">
						<div class="panel panel-default">
							<div class="list-group">
								<div ng-repeat="response in jsonResponse">
									<div ng-repeat="myResults in response.results.result">
										<a class="list-group-item" href="#">
											<div class="row">
												<div class="col-sm-6">
													<i class="fa fa-3x fa-building-o pull-left"></i>
													<h4 class="list-group-item-heading">{{myResults.jobtitle}}</h4>
													<p class="list-group-item-text">{{myResults.formattedLocation}}</p>
												</div>
											</div>
										</a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="tab-pane fade" id="WritingJobs">
					<h3>Writing Jobs</h3>
					<p>These are the writing jobs</p>
				</div>
				<div class="tab-pane fade" id="AllJobs">
					<h3>All Jobs</h3>
					<p>These are all of Indeed's Jobs</p>
				</div>
			</div>
        </div>
		<script>
		var htmlToSend = '<div class="bootcards-list"><div class="panel panel-default"><div class="list-group"><a class="list-group-item" href="#"><div class="row"><div class="col-sm-6"><i class="fa fa-3x fa-building-o pull-left"></i><h4 class="list-group-item-heading">Some Company</h4><p class="list-group-item-text">Manchester, NH</p></div></div></a></div></div></div>'
        var my_x2js = new X2JS();

		var app = angular.module("myApp", []);
		app.controller("myCtrl", function ($sce, $scope, $http) {
		$scope.writingHtml = $sce.trustAsHtml(htmlToSend)

		});
		app.controller("parseString", function ($scope, $sce, $http) {
			var vm = this;
			vm.response = [];
            $scope.indeedRequestUrl = "//api.indeed.com/ads/apisearch?"
            $scope.indeedStringBuild = {"publisher": 9810209592087925, "v": 2, "format": "json", "callback": "",
                                  "q": "", "l": "", "sort": "", "radius": "", "st": "", "jt": "", "start": "",
                                  "limit": 10, "fromage": "", "highlight": "", "filter": 1, "latlong": 0, "chnl": "",
                                  "co": "us", "userip": "1.2.3.4", "useragent": navigator.userAgent };

            $scope.indeedUrlBuilder = function (baseUrl, GivenJson) {
                var urlToReturn = "";

                urlToReturn += baseUrl;

                for (var key in GivenJson) {
                    if (GivenJson.hasOwnProperty(key)) {  //THIS WORKS!!
                        // console.log(key + " -> " + GivenJson[key]);
                        //if(key == "useragent") {
                        //urlToReturn += key + "=" + navigator.userAgent + "&";
                        //}
                        //else {
                        urlToReturn += key + "=" + GivenJson[key] + "&";
                        //}
                    }
                }

                // console.log(urlToReturn);

                return urlToReturn;
            };

            // console.log($scope.stringBuild send api request);
            // $scope.requestUrl = $scope.indeedUrlBuilder($scope.indeedRequestUrl, $scope.indeedStringBuild)
            $scope.requestUrl = $scope.indeedUrlBuilder($scope.indeedRequestUrl, $scope.indeedStringBuild);
            console.log($scope.requestUrl);

            // Normally, We'd continue with this code, but for some reason, it won't give us a proper response.
            /*
            $http.get($scope.requestUrl)
            .then(function(response) {
                $scope.JsonStringReturn = response.data;
                console.log(response.status);
                console.log(response.statustext);
            });
            */
            // For now, we must assume that we have a JSON string to setup list-group stuff on the main page
            $scope.get_xml_data = function () {
				$http.get("programmingResponse.xml").then(function(data) {
					//console.log(data.data);
					vm.response = data.data;
				}).then(function (data) {
					//console.log(typeof(vm.response));
					$scope.jsonResponse = my_x2js.xml_str2json(vm.response);
				}).then(function (data) {
					console.log($scope.jsonResponse);
				});
			};
            //$scope.JsonStringReturn = x2js.xml2json($scope.xml);
            $scope.get_xml_data();

			//console.log($scope.xml);
			//console.log(my_x2js.xml_str2json(String(vm.response)));
            //console.log($scope.JsonStringReturn);

		});
		</script>
	</body>
</html>
